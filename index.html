<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Code Playground</title>
    <link
      rel="stylesheet"
      href="http://unpkg.com/jest-lite@1.0.0-alpha.4/dist/prettify.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/codemirror.min.css"
    />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      .toolbar {
        padding: 5px;
        background-color: #f5f5f5;
        border-bottom: 1px solid #ddd;
      }

      .CodeMirror {
        height: 100%;
      }

      button {
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 5px 10px;
        margin-right: 5px;
        cursor: pointer;
        font-size: 14px;
        border-radius: 3px;
      }

      button:hover {
        background-color: #0056b3;
      }

      .editor-container {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      .editor {
        flex: 1;
        border: 1px solid #ccc;
        margin-right: 10px;
      }

      .editor:last-child {
        margin-right: 0;
      }

      .preview-container {
        display: flex;
        flex-direction: column;
        background-color: #f5f5f5;
        padding: 10px;
        height: 50%;
        overflow: auto;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      h3 {
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <div class="toolbar">
      <button onclick="updatePreview()">Run</button>
      <button onclick="runTests()">Test</button>
    </div>
    <div class="editor-container">
      <div class="editor" id="htmlEditor"></div>
      <div class="editor" id="cssEditor"></div>
      <div class="editor" id="jsEditor"></div>
      <div class="editor" id="testEditor"></div>
    </div>
    <div class="preview-container">
      <h3>Preview</h3>
      <iframe id="preview"></iframe>
      <h3>Test Results</h3>
      <div id="test-results"></div>
    </div>

    <script
      crossorigin
      src="https://unpkg.com/react@16/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"
    ></script>
    <script
      crossorigin
      src="http://unpkg.com/jest-lite@1.0.0-alpha.4/dist/core.js"
    ></script>
    <script
      crossorigin
      src="http://unpkg.com/jest-lite@1.0.0-alpha.4/dist/enzyme.js"
    ></script>
    <script
      crossorigin
      src="http://unpkg.com/jest-lite@1.0.0-alpha.4/dist/prettify.js"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.62.3/mode/htmlmixed/htmlmixed.min.js"></script>
    <script>
      const {
        core: { describe, it, expect, run },
        enzyme: { mount },
        prettify,
      } = window.jestLite;

      const htmlEditor = CodeMirror(document.getElementById("htmlEditor"), {
        mode: "htmlmixed",
        lineNumbers: true,
        theme: "default",
      });

      const cssEditor = CodeMirror(document.getElementById("cssEditor"), {
        mode: "css",
        lineNumbers: true,
        theme: "default",
  });

  const jsEditor = CodeMirror(document.getElementById("jsEditor"), {
    mode: "javascript",
    lineNumbers: true,
    theme: "default",
  });

  const testEditor = CodeMirror(document.getElementById("testEditor"), {
    mode: "javascript",
    lineNumbers: true,
    theme: "default",
  });

  htmlEditor.setValue('<h1>test</h1>');
  cssEditor.setValue('h1 { color: red; }');
  jsEditor.setValue('function add(a, b) { return a + b }');
  testEditor.setValue(`describe('test demo', () => {
    it ('Verify if are received and returned only numbers', () => {
      expect(2+3).toBe(5);
    });
  });`);

  function updatePreview() {
    const html = htmlEditor.getValue();
    const css = cssEditor.getValue();
    const js = jsEditor.getValue();
    const previewFrame = document.getElementById('preview');
    const preview = previewFrame.contentDocument || previewFrame.contentWindow.document;
    preview.open();
    preview.write(`<style>${css}</style>${html}<scr` + `ipt>${js}</scr` + `ipt>`);
    preview.close();
  }

  function runTests() {
    const testCode = testEditor.getValue();
    const testResults = document.getElementById('test-results');
    testResults.innerHTML = '';
    try {
      eval(testCode);
      const result = run();
      prettify.toHTML(result, testResults);
    } catch (error) {
      testResults.innerHTML = `<pre style="color: red">${error}</pre>`;
    }
  }
</script>
</body>
</html>
